# .github/workflows/ci-pipeline.yaml

name: CI Pipeline - Run Tests

on:
  push:
    branches: [ master ] # Or 'main' if that's your default branch

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    # This 'env' block makes the variables available to all steps in the job
    env:
      # We provide dummy/redirect variables to bypass the CrewAI bug during testing.
      # The tests don't make real API calls, so the key value doesn't matter.
      OPENAI_API_KEY: "DUMMY_KEY_FOR_TESTING"
      OPENAI_API_BASE: "https://api.groq.com/openai/v1" # Needs a valid URL structure
      OPENAI_MODEL_NAME: "llama-3.3-70b-versatile"

    steps:
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run Pytest
        # The environment variables defined above are automatically available to this step
        run: pytest